---
title: "Calculate correlation across all 1Mb bins"
output: html_notebook
---

```{r}
# read data
df <- read_tsv(file="merged_hgmm_bins_.tsv")
colnames(df) <- sub("_hgmm_weight_mu170", "", colnames(df))
df$chr_bin <- paste(df$chrom, df$bin, sep="_")

# calculate average value for healthy samples
df$HVavg <- rowMeans(df[c("HV01", "HV03", "HV04", "HV05", "HV06", "HV07", "HV08")], dims = 1)

# drop columns such as chr_bin before calculating correlation
df <- df[ , -which(names(df) %in% c("chr_bin", "chrom", "bin"))]

### Correlation: cancer samples to healthy average
Sample <- vector()
R <- vector()
for (samp in colnames(df %>% dplyr::select(-contains("HV")))) {
  R <- append(R, cor(df[samp], df["HVavg"]))
  Sample <- append(Sample, samp)
}
corrs <- data.frame(sample=Sample, correlation_to_healthy=R)

### Correlation: leave-one-out correlation for healthy sample and healthy average
# create a new data frame with healthy samples
healthy <- df[c("HV01", "HV03", "HV04", "HV05", "HV06", "HV07", "HV08")]
cols <- colnames(healthy)

# leave-one-out correlation
R_healthy <- vector()
for (i in 1:length(cols)){
  new_column <- data.frame(rowMeans(healthy[cols[-i]], dims = 1))
  colnames(new_column) <- paste("HVavgwo", cols[i], sep="_")
  healthy <- cbind(healthy, new_column)
  R_healthy <- append(R_healthy, cor(healthy[cols[i]], new_column))
}
corrs_healthy <- data.frame(sample=cols, correlation_to_healthy=R_healthy)


# Bind two datasets into final corrs dataframe
corrs <- rbind(corrs, corrs_healthy)

```

